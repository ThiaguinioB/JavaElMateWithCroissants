# 游 GitHub Actions Workflow para An치lisis de Seguridad con Horusec CLI
#
# Este workflow ejecuta autom치ticamente un an치lisis de seguridad SAST (Static Application Security Testing)
# utilizando Horusec CLI cada vez que hay cambios en el c칩digo.
#
# Caracter칤sticas principales:
# - An치lisis completo del c칩digo fuente en busca de vulnerabilidades de seguridad
# - Generaci칩n de reportes en formato JSON para procesamiento automatizado
# - Bloqueo del pipeline si se detectan vulnerabilidades cr칤ticas
# - Almacenamiento de reportes como artifacts de GitHub para revisi칩n posterior

name: Horusec Security Analysis

# 游꿢 Triggers: Define cu치ndo se ejecuta el workflow
on:
  push:
    branches: [ "docker-compose/horusec" ]  # Se ejecuta en push a la rama de desarrollo
  pull_request:
    branches: [ "main" ]                    # Se ejecuta en PRs hacia main para validar antes del merge

jobs:
  horusec-security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Reiniciar Docker
        run: |
          sudo systemctl restart docker
          sudo systemctl enable docker
      - name: Verificar Docker
        run: docker ps
      - name: Ejecutar an치lisis Horusec
        run: |
          docker run --rm \
            -v ${{ github.workspace }}:/src \
            horuszup/horusec-cli horusec start \
            -p /src \
            --return-error \
            --output-format json \
            --json-output-file /src/.horusec/horusec-report.json