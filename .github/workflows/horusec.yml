# üîí GitHub Actions Workflow para An√°lisis de Seguridad con Horusec CLI
#
# Este workflow ejecuta autom√°ticamente un an√°lisis de seguridad SAST (Static Application Security Testing)
# utilizando Horusec CLI cada vez que hay cambios en el c√≥digo.
#
# Caracter√≠sticas principales:
# - An√°lisis completo del c√≥digo fuente en busca de vulnerabilidades de seguridad
# - Generaci√≥n de reportes en formato JSON para procesamiento automatizado
# - Bloqueo del pipeline si se detectan vulnerabilidades cr√≠ticas
# - Almacenamiento de reportes como artifacts de GitHub para revisi√≥n posterior

name: Horusec Security Analysis

# üéØ Triggers: Define cu√°ndo se ejecuta el workflow
on:
  push:
    branches: [ "docker-compose/horusec" ]  # Se ejecuta en push a la rama de desarrollo
  pull_request:
    branches: [ "main" ]                    # Se ejecuta en PRs hacia main para validar antes del merge

jobs:
  horusec-security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Reiniciar Docker
        run: |
          sudo systemctl restart docker
          sudo systemctl enable docker
      - name: Verificar Docker
        run: docker ps
      - name: Ejecutar an√°lisis Horusec
        run: |
          docker run --rm \
            -v /var/run/docker.sock:/var/run/docker.sock \  # ‚Üê Esto es clave
            -v ${{ github.workspace }}:/src \
            horuszup/horusec-cli horusec start \
            -p /src \
            --return-error \
            --output-format json \
            --json-output-file /src/.horusec/horusec-report.json