# ğŸ³ Dockerfile personalizado para Horusec CLI con validaciÃ³n de umbrales
#
# Este Dockerfile extiende la imagen oficial de Horusec CLI aÃ±adiendo:
# - Herramientas adicionales (Docker, jq) para procesamiento de reportes
# - Script personalizado de validaciÃ³n de umbrales de vulnerabilidades
# - ConfiguraciÃ³n automatizada para anÃ¡lisis y validaciÃ³n en un solo paso
#
# Uso: docker build -f Dockerfile.horusec -t custom-horusec .
#      docker run -v $(pwd):/src custom-horusec

# ğŸ“¦ Imagen base: Horusec CLI oficial (versiÃ³n beta con mejoras)
FROM horuszup/horusec-cli:v2.9.0-beta.3

# ğŸ› ï¸ Instalar herramientas adicionales necesarias
RUN apk add --no-cache \
    docker \
    jq
# docker: Para anÃ¡lisis de contenedores Docker
# jq: Para procesamiento de JSON en el script de validaciÃ³n

# ğŸ“‹ Copiar script de validaciÃ³n personalizado
COPY validate_thresholds.sh /usr/local/bin/validate_thresholds.sh
RUN chmod +x /usr/local/bin/validate_thresholds.sh

# ğŸ“ Establecer directorio de trabajo
WORKDIR /src

# ğŸš€ Comando por defecto: Ejecutar anÃ¡lisis + validaciÃ³n en secuencia
CMD ["sh", "-c", "\
    horusec start \                                     
    --project-path /src \                               
    --container-bind-project-path=/src \                
    -o=json \                                           
    -O /src/.horusec/output.json \                      
    --log-level=debug && \                              
    validate_thresholds.sh"]

# ğŸ“ ExplicaciÃ³n de parÃ¡metros de Horusec:
# --project-path: Ruta del proyecto a analizar
# --container-bind-project-path: Ruta de binding para containers
# -o=json: Formato de salida JSON
# -O: Archivo de salida del reporte
# --log-level=debug: Nivel de logging detallado
#
# El operador && ejecuta validate_thresholds.sh solo si Horusec termina exitosamente
