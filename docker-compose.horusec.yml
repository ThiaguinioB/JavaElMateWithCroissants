# ğŸ”’ Docker Compose para anÃ¡lisis de seguridad con Horusec CLI
#
# Este archivo define la configuraciÃ³n para ejecutar anÃ¡lisis de seguridad
# usando Horusec CLI en un entorno containerizado.
#
# CaracterÃ­sticas:
# - Construye imagen personalizada con validaciÃ³n de umbrales
# - Monta el cÃ³digo fuente como volumen para anÃ¡lisis
# - Configura umbrales de vulnerabilidades mediante variables de entorno
# - Persiste reportes en el sistema de archivos del host
#
# Uso: docker-compose -f docker-compose.horusec.yml up --build

services:
  # ğŸ” Servicio principal: Horusec CLI con validaciÃ³n personalizada
  horusec-cli:
    # ğŸ—ï¸ ConstrucciÃ³n de imagen personalizada
    build:
      context: . # Contexto de construcciÃ³n (directorio actual)
      dockerfile: Dockerfile.horusec # Dockerfile especÃ­fico para Horusec

    # ğŸŒ Variables de entorno para configuraciÃ³n
    environment:
      # ğŸ“‚ Ruta del proyecto en el host (para referencia)
      - HOST_PROJECT_PATH=${PWD}

      # ğŸš¨ Umbrales de vulnerabilidades (definir segÃºn polÃ­tica de seguridad)
      # Si no se definen, el script usarÃ¡ valores por defecto
      - HORUSEC_MAX_CRITICAL_VULNERABILITY # MÃ¡ximo de vulnerabilidades CRÃTICAS permitidas
      - HORUSEC_MAX_HIGH_VULNERABILITY # MÃ¡ximo de vulnerabilidades ALTAS permitidas  
      - HORUSEC_MAX_MEDIUM_VULNERABILITY # MÃ¡ximo de vulnerabilidades MEDIAS permitidas
      - HORUSEC_MAX_LOW_VULNERABILITY # MÃ¡ximo de vulnerabilidades BAJAS permitidas

    # ğŸ’¾ VolÃºmenes montados
    volumes:
      # ğŸ“ Montar cÃ³digo fuente completo para anÃ¡lisis
      - .:/src

      # ğŸ³ Socket de Docker para anÃ¡lisis de containers (si es necesario)
      - /var/run/docker.sock:/var/run/docker.sock

      # ğŸ“‹ Directorio de reportes persistente en el host
      - ./src/.horusec:/src/.horusec # Asegura que el JSON se guarde en el host

    # ğŸ“ Directorio de trabajo dentro del container
    working_dir: /src
